{% extends 'template/jhTemplateV4.html'%}{% block vueTemplate %}<script type="text/html" id="app-template">    <div>        <v-app id="inspire" mobile-breakpoint="sm">            <jh-menu />            <v-main class="d-flex flex-column" style="margin-top: 60px">                <!-- 头部内容 >>>>>>>>>>>>> -->                <div class="jh-page-second-bar px-8">                  <v-row class="align-center" dense>                    <v-col cols="12" xs="12" sm="4" md="4" xl="3">                      <div class="py-4 text-body-1 font-weight-bold d-flex align-center">{{ breadcrumbs[1].fullText }}</div>                    </v-col>                    <!-- 搜索条件表单 >>>>>>>> -->                    <v-col cols="12" xs="12" sm="8" md="8" xl="9">                      <v-row class="jh-backend-form-container justify-end ma-0 py-3">                        <div class="jh-backend-search-btn">                          <v-btn @click="doUiAction('refreshTableData')" class="elevation-0 float-right mt-2 mt-md-0" color="success" small>                            查询                          </v-btn>                          <v-btn @click="doUiAction('getUserInfo')" class="elevation-0 float-right mt-2 mr-2 mt-md-0" color="success" small>                            service测试                          </v-btn>                        </div>                      </v-row>                    </v-col>                    <!-- <<<<<<<< 搜索条件表单 -->                  </v-row>                </div>                <!-- <<<<<<<<<<<<< 头部内容 -->                <div class="pageBodyContainer px-8" style="flex: 1;">                    <!-- 页面内容 >>>>>>>>>>>>> -->                    <v-container class="fullScreen d-flex flex-column pa-xs-0 pa-0">                        <v-card>                            <v-row class="ma-0 pa-xs-4 align-center flex-none pt-0 " :class="{'pa-4': !isMobile, 'pb-0': !isMobile, 'pa-2': isMobile}">                                <v-col cols="12" xs="4" sm="4" md="4" xl="4" class="pl-0">                                    <v-btn color="success" dark class="elevation-0 mr-2" @click="doUiAction('startCreateItem')" small>新增</v-btn>                                </v-col>                                <v-col cols="12" xs="4" sm="4" md="4" xl="4" class="pl-0">                                    <input type="file" ref="fileChoose" style="position: absolute; z-index: -1; top: -100vh;"/>                                    <v-btn color="success" dark class="elevation-0 mr-2" @click="doUiAction('uploadFile')" small>上传文件</v-btn>                                </v-col>                                <v-spacer></v-spacer>                                <v-col cols="12" xs="3" sm="3" md="2" xl="2" class="pa-xs-0 pa-xs-2 col-sm-8-flex">                                    <v-text-field v-model="searchInput" label="表格过滤" class="cus-v-input" dense filled single-line></v-text-field>                                </v-col>                            </v-row>                            {{upload + uploadImage + '?size=500x500'}}                            <img :src="upload + uploadImage + '?size=500x500'"/>                            <v-data-table                                    fixed-header                                    :headers="headers"                                    :items="tableData"                                    :search="searchInput"                                    :footer-props="{ itemsPerPageOptions: [20, 40, 60, 100, -1], itemsPerPageText: '每页行数', itemsPerPageAllText: '所有'}"                                    :items-per-page="20"                                    mobile-breakpoint="0"                                    :loading="isTableLoading"                                    checkbox-color="success"                                    :class="{'zebraLine': showTableZebraLine }"                                    class="fixed-table-height elevation-0 mt-0 mb-xs-4 flex-fill d-flex flex-column">                                <template v-slot:footer.prepend>                                    <span class="ml-2 table-search-hint-text">共{{ tableData.length }}条记录</span>                                    <v-menu top offset-y :close-on-content-click="false">                                        <template v-slot:activator="{ on, attrs }">                                            <v-btn v-bind="attrs" v-on="on" icon>                                                <v-icon>mdi-menu</v-icon>                                            </v-btn>                                        </template>                                        <v-list>                                            <v-list-item>                                                <v-switch v-model="showTableZebraLine" label="显示斑马纹" dense flat></v-switch>                                            </v-list-item>                                        </v-list>                                    </v-menu>                                </template>                                <template v-slot:footer.page-text="pagination">                                    <span>{{pagination.pageStart}}-{{pagination.pageStop}}</span>                                    <span class="ml-1">共{{pagination.itemsLength}}条</span>                                </template>                                <template v-slot:item.action="{ item }">                                    <v-btn v-for="tableButton of tableButtonList" :color="tableButton.color" outlined x-small class="elevation-0 mr-2" @click="doUiAction(tableButton.action, {item, button: tableButton})">{{ tableButton.text }}</v-btn>                                </template>                            </v-data-table>                        </v-card>                    </v-container>                    <!-- 新增 -->                    <v-navigation-drawer v-model="isAddDrawerShow" :permanent="isAddDrawerShow" fixed temporary right width="80%" class="elevation-24">                        <v-form v-model="isFormValid" v-if="isAddDrawerShow" ref="form" lazy-validation>                            <!--抽屉标题-->                            <v-row>                                <span class="title pa-6" :class="{'pl-8': !isMobile, 'pl-6': isMobile}">新增信息</span>                            </v-row>                            <!--抽屉表单-->                            <v-row class="mt-0" :class="{'px-6': !isMobile, 'px-3': isMobile, 'pb-7': isMobile}">                                <v-col cols="12" sm="12" md="4" xl="3" :class="{'pa-0': isMobile, 'px-4': isMobile, 'pt-6': isMobile}">                                    <span class="inputLabel">学生ID</span>                                    <v-text-field class="cus-v-input " :rules="requireRules" required dense filled single-line v-model="addItem['studentId']"></v-text-field>                                </v-col>                                <v-col cols="12" sm="12" md="4" xl="3" :class="{'pa-0': isMobile, 'px-4': isMobile, 'pt-6': isMobile}">                                    <span class="inputLabel">学生名字</span>                                    <v-text-field class="cus-v-input " dense filled single-line v-model="addItem['name']"></v-text-field>                                </v-col>                                <v-col cols="12" sm="12" md="4" xl="3" :class="{'pa-0': isMobile, 'px-4': isMobile, 'pt-6': isMobile}">                                    <span class="inputLabel">性别</span>                                    <v-text-field class="cus-v-input " dense filled single-line v-model="addItem['gender']"></v-text-field>                                </v-col>                                <v-col cols="12" sm="12" md="4" xl="3" :class="{'pa-0': isMobile, 'px-4': isMobile, 'pt-6': isMobile}">                                    <span class="inputLabel">出生日期</span>                                    <v-text-field class="cus-v-input " dense filled single-line v-model="addItem['dateOfBirth']"></v-text-field>                                </v-col>                                <v-col cols="12" sm="12" md="4" xl="3" :class="{'pa-0': isMobile, 'px-4': isMobile, 'pt-6': isMobile}">                                    <span class="inputLabel">班级ID</span>                                    <v-text-field class="cus-v-input " dense filled single-line v-model="addItem['classId']"></v-text-field>                                </v-col>                                <v-col cols="12" sm="12" md="4" xl="3" :class="{'pa-0': isMobile, 'px-4': isMobile, 'pt-6': isMobile}">                                    <span class="inputLabel">年级</span>                                    <v-text-field class="cus-v-input " dense filled single-line v-model="addItem['level']"></v-text-field>                                </v-col>                                <v-col cols="12" sm="12" md="4" xl="3" :class="{'pa-0': isMobile, 'px-4': isMobile, 'pt-6': isMobile}">                                    <span class="inputLabel">身高</span>                                    <v-text-field class="cus-v-input " dense filled single-line v-model="addItem['bodyHeight']"></v-text-field>                                </v-col>                                <v-col cols="12" sm="12" md="4" xl="3" :class="{'pa-0': isMobile, 'px-4': isMobile, 'pt-6': isMobile}">                                    <span class="inputLabel">学生状态</span>                                    <v-text-field class="cus-v-input " dense filled single-line v-model="addItem['studentStatus']"></v-text-field>                                </v-col>                                <v-col cols="12" sm="12" md="4" xl="3" :class="{'pa-0': isMobile, 'px-4': isMobile, 'pt-6': isMobile}">                                    <span class="inputLabel">备注</span>                                    <v-text-field class="cus-v-input " dense filled single-line v-model="addItem['remarks']"></v-text-field>                                </v-col>                            </v-row>                            <!--抽屉操作按钮-->                            <v-row class="mx-0 justify-end mt-4" :class="{'px-4': isMobile, 'px-6': !isMobile, 'mb-8': isMobile}">                                <v-btn color="success" @click="doUiAction('createItem')" small>保存</v-btn>                                <v-btn class="elevation-0 ml-2" @click="isAddDrawerShow = false" small>取消</v-btn>                            </v-row>                        </v-form>                        <!--抽屉关闭按钮-->                        <v-btn elevation="0" color="success" fab absolute top left small tile class="drawer-close-float-btn" @click="isAddDrawerShow = false">                            <v-icon>mdi-close</v-icon>                        </v-btn>                    </v-navigation-drawer>                    <!-- 编辑抽屉 -->                    <v-navigation-drawer v-model="isEditDrawerShow" :permanent="isEditDrawerShow" fixed temporary right width="80%" class="elevation-24">                        <v-form v-model="isFormValid" v-if="isEditDrawerShow" ref="form" lazy-validation>                            <!--抽屉标题-->                            <v-row>                                <span class="title pa-6" :class="{'pl-8': !isMobile, 'pl-6': isMobile}">编辑信息</span>                            </v-row>                            <!--抽屉表单-->                            <v-row class="mt-0" :class="{'px-6': !isMobile, 'px-3': isMobile, 'pb-7': isMobile}">                                <v-col cols="12" sm="12" md="4" xl="3" :class="{'pa-0': isMobile, 'px-4': isMobile, 'pt-6': isMobile}">                                    <span class="inputLabel">学生ID</span>                                    <v-text-field class="cus-v-input " dense filled single-line v-model="editItem['studentId']"></v-text-field>                                </v-col>                                <v-col cols="12" sm="12" md="4" xl="3" :class="{'pa-0': isMobile, 'px-4': isMobile, 'pt-6': isMobile}">                                    <span class="inputLabel">学生名字</span>                                    <v-text-field class="cus-v-input " dense filled single-line v-model="editItem['name']"></v-text-field>                                </v-col>                                <v-col cols="12" sm="12" md="4" xl="3" :class="{'pa-0': isMobile, 'px-4': isMobile, 'pt-6': isMobile}">                                    <span class="inputLabel">性别</span>                                    <v-text-field class="cus-v-input " dense filled single-line v-model="editItem['gender']"></v-text-field>                                </v-col>                                <v-col cols="12" sm="12" md="4" xl="3" :class="{'pa-0': isMobile, 'px-4': isMobile, 'pt-6': isMobile}">                                    <span class="inputLabel">出生日期</span>                                    <v-text-field class="cus-v-input " dense filled single-line v-model="editItem['dateOfBirth']"></v-text-field>                                </v-col>                                <v-col cols="12" sm="12" md="4" xl="3" :class="{'pa-0': isMobile, 'px-4': isMobile, 'pt-6': isMobile}">                                    <span class="inputLabel">班级ID</span>                                    <v-text-field class="cus-v-input " dense filled single-line v-model="editItem['classId']"></v-text-field>                                </v-col>                                <v-col cols="12" sm="12" md="4" xl="3" :class="{'pa-0': isMobile, 'px-4': isMobile, 'pt-6': isMobile}">                                    <span class="inputLabel">年级</span>                                    <v-text-field class="cus-v-input " dense filled single-line v-model="editItem['level']"></v-text-field>                                </v-col>                                <v-col cols="12" sm="12" md="4" xl="3" :class="{'pa-0': isMobile, 'px-4': isMobile, 'pt-6': isMobile}">                                    <span class="inputLabel">身高</span>                                    <v-text-field class="cus-v-input " dense filled single-line v-model="editItem['bodyHeight']"></v-text-field>                                </v-col>                                <v-col cols="12" sm="12" md="4" xl="3" :class="{'pa-0': isMobile, 'px-4': isMobile, 'pt-6': isMobile}">                                    <span class="inputLabel">学生状态</span>                                    <v-text-field class="cus-v-input " dense filled single-line v-model="editItem['studentStatus']"></v-text-field>                                </v-col>                                <v-col cols="12" sm="12" md="4" xl="3" :class="{'pa-0': isMobile, 'px-4': isMobile, 'pt-6': isMobile}">                                    <span class="inputLabel">备注</span>                                    <v-text-field class="cus-v-input " dense filled single-line v-model="editItem['remarks']"></v-text-field>                                </v-col>                                <!--      <v-col cols="12" sm="12" md="4" xl="3" :class="{'pa-0': isMobile, 'px-4': isMobile, 'pt-6': isMobile}">-->                                <!--        &lt;!&ndash; 必填字段样式 demo :rules="requireRules" &ndash;&gt;-->                                <!--            <span class="inputLabel">学生ID</span>-->                                <!--        <v-text-field class="cus-v-input " dense filled single-line label="学生ID" v-model="editItem.studentId" :rules="requireRules"></v-text-field>-->                                <!--      </v-col>-->                                <!--      &lt;!&ndash; select 字段 demo &ndash;&gt;-->                                <!--      <v-col cols="12" sm="12" md="4" xl="3" :class="{'pa-0': isMobile, 'px-4': isMobile, 'pt-6': isMobile}">-->                                <!--            <span class="inputLabel">班级ID</span>-->                                <!--        <v-select class="cus-v-input " dense filled single-line clearable label="班级ID" v-model="editItem.classId" :items="constantCollection.classId"></v-select>-->                                <!--      </v-col>-->                                <!--      &lt;!&ndash; 日期选择 demo &ndash;&gt;-->                                <!--      <v-col cols="12" sm="12" md="4" xl="3" :class="{'pa-0': isMobile, 'px-4': isMobile, 'pt-6': isMobile}">-->                                <!--        <span class="inputLabel">出生日期</span>-->                                <!--        <v-menu class="cus-v-input " offset-y max-width="290">-->                                <!--          <template v-slot:activator="{ on, attrs }">-->                                <!--            <v-text-field class="cus-v-input " dense filled single-line v-on="on" label="出生日期" v-model="editItem.dateOfBirth"></v-text-field>-->                                <!--          </template>-->                                <!--          <v-date-picker color="success" elevation="20" v-model="editItem.dateOfBirth"></v-date-picker>-->                                <!--        </v-menu>-->                                <!--      </v-col>-->                            </v-row>                            <!--抽屉操作按钮-->                            <v-row class="mx-0 justify-end mt-4" :class="{'px-4': isMobile, 'px-6': !isMobile, 'mb-8': isMobile}">                                <v-btn color="success" @click="doUiAction('updateItem')" small>保存</v-btn>                                <v-btn class="elevation-0 ml-2" @click="isEditDrawerShow = false" small>取消</v-btn>                            </v-row>                        </v-form>                        <!--抽屉关闭按钮-->                        <v-btn elevation="0" color="success" fab absolute top left small tile class="drawer-close-float-btn" @click="isEditDrawerShow = false">                            <v-icon>mdi-close</v-icon>                        </v-btn>                    </v-navigation-drawer>                    <!-- <<<<<<<<<<<<< 页面内容 -->                </div>                <!-- 帮助页抽屉 >>>>>>>>>>>>> -->                <v-navigation-drawer v-model="isHelpPageDrawerShow" fixed temporary right width="80%" class="elevation-24">                    <iframe style="border: 0" :src="`/${appInfo.appId}/pageDoc?markdownPath#1.studentManagement.md`" width="100%" height="100%"></iframe>                    <v-btn elevation="0" color="success" fab absolute top left small tile class="drawer-close-float-btn" @click="isHelpPageDrawerShow = false">                        <v-icon>mdi-close</v-icon>                    </v-btn>                </v-navigation-drawer>                <!-- <<<<<<<<<<<<< 帮助页抽屉 -->            </v-main>        </v-app>        <jh-toast></jh-toast>        <jh-mask></jh-mask>        <jh-confirm-dialog></jh-confirm-dialog>    </div></script><div id="app"></div>{% endblock %}{% block vueScript %}<script type="module">    new Vue({        el: '#app',        template: '#app-template',        vuetify: new Vuetify(),        data: () => ({            showTableZebraLine: true,            // 表格相关数据            isFormValid: true,            upload: window.appInfo.upload,            requireRules: [                v => !!v || 'This is required',            ],            constantCollection: {            },            serverSearchInput: {                studentId: null,                classId: null            },            searchInput: null,            isTableLoading: true,            tableDataFromBackend: [],            headers: [                {text: '操作', value: 'action', align: 'center', sortable: false, width: 200, class: 'fixed', cellClass: 'fixed'},                {text: "ID", value: "id", width: 120, class: 'fixed', cellClass: 'fixed'},                {text: "学生ID", value: "studentId", width: 120},                {text: "学生名字", value: "name", width: 120},                {text: "性别", value: "gender", width: 120},                {text: "出生日期", value: "dateOfBirth", width: 120},                {text: "班级ID", value: "classId", width: 120},                {text: "年级", value: "level", width: 120},                {text: "身高", value: "bodyHeight", width: 120},                {text: "学生状态", value: "studentStatus", width: 120},                {text: "备注", value: "remarks", width: 120},                {text: "操作者", value: "operationByUser", width: 120},                {text: "操作时间", value: "operationAt", width: 250},            ],            tableButtonList: [                {text: '修改', buttonType: 'edit', color: 'success', action: 'startUpdateItem'},                {text: '删除', buttonType: 'delete', color: 'error', action: 'deleteItem'},            ],            isEditDrawerShow: false,            editItem: {},            isAddDrawerShow: false,            addItem: {},            breadcrumbs: [{                fullText: "首页",            },{                fullText: "学生管理",            }],            isHelpPageDrawerShow: false,            uploadImage: null        }),        computed: {            isMobile() {                return window.innerWidth < 600;            },            tableData() {                return this.tableDataFromBackend;            }        },        watch: {},        async created() {            await this.doUiAction('refreshTableData');        },        mounted() {},        methods: {            async doUiAction(uiActionId, uiActionData) {                switch (uiActionId) {                    case 'refreshTableData':                        await this.refreshTableData();                        break;                  case 'getUserInfo':                        await this.getUserInfo();                        break;                    case 'uploadFile':                        await this.uploadFile();                        break;                    case 'startCreateItem':                        await this.clearItemData();                        await this.openCreateItemDialog();                        break;                    case 'createItem':                        await this.prepareValidate();                        await this.confirmCreateItemDialog();                        await this.doCreateItem();                        await this.closeDrawerShow();                        await this.refreshTableData();                        break;                    case 'startUpdateItem':                        await this.prepareItemData(uiActionData);                        await this.openUpdateDialog();                        break;                    case 'updateItem':                        await this.prepareValidate();                        await this.confirmUpdateItemDialog();                        await this.doUpdateItem();                        await this.closeDrawerShow();                        await this.refreshTableData();                        break;                    case 'deleteItem':                        await this.confirmDeleteItemDialog();                        await this.doDeleteItem(uiActionData);                        await this.refreshTableData();                        break;                    default:                        console.error("[doUiAction] uiActionId not find", { uiActionId });                        break;                }            },            uploadFile() {                this.$refs.fileChoose.click();                this.$refs.fileChoose.onchange = async (e) => {                    const file = e.target.files[0];                    await window.vtoast.loading("上传文件");                    const fileDirectory = "test";                    const fileDesc = "test test";                    const filenameStorage = "testText";                    const res = await window.jianghuAxios.httpUploadByStream({                        file, fileDirectory, fileDesc, filenameStorage,  onProgress: (total, loaded) =>{                            window.vtoast.loading("上传进度: " + (loaded + 2)/total*100 + "%");                        }                    });                    console.log(res.data.appData.resultData.fileName)                    this.uploadImage = res.data.appData.resultData.fileName;                    await window.vtoast.success("上传文件成功");                }            },            // =================================uiAction 公共方法 start ======================================            /**             * uiActionId:  refreshTableData             * description: ✅获取表格数据             */            async refreshTableData() {                this.isTableLoading = true;                const serverSearchInput = _.pickBy(this.serverSearchInput, value=> !!value);                const result = await window.jianghuAxios({                    data: {                        appData: {                            pageId: 'studentManagement',                            actionId: 'selectItemList',                            actionData: {},                            where: serverSearchInput,                            whereLike: {},                            orderBy: [{column: 'operationAt', order: 'desc'}]                        }                    }                });                this.tableDataFromBackend = result.data.appData.resultData.rows;                this.isTableLoading = false;            },            // =================================uiAction 公共方法 end ======================================            async getUserInfo() {              const { userId, username, user, allowPageList } = (await window.jianghuAxios({                data: {                  appData: {                    pageId: 'allPage',                    actionId: 'userInfo',                    actionData: {                      testContent: "1001"                    },                  }                }              })).data.appData.resultData;              window.vtoast.success(`allPage.userInfo数据: username: ${username}`);            } ,            /**             * uiActionId:  startCreateItem             * description: ✅获取表格数据             */            async clearItemData() {                this.addItem = {};            },            async openCreateItemDialog() {                this.isAddDrawerShow = true;            },            // 表单验证            async prepareValidate() {                if (await this.$refs.form.validate() === false) {                    throw new Error("[prepareValidate] false");                }            },            /**             * uiActionId:  createItem             * description: ✅获取表格数据             */            async confirmCreateItemDialog() {                if (await window.confirmDialog({title: "新增", content: "确定新增吗？"}) === false) {                    throw new Error("取消");                }            },            async doCreateItem() {                const { id, ...data } = this.addItem;                await window.vtoast.loading("新增数据");                await window.jianghuAxios({                    data: {                        appData: {                            pageId: 'studentManagement',                            actionId: 'insertItem',                            actionData: data                        }                    }                })                await window.vtoast.success("新增数据成功");            },            async closeDrawerShow() {                this.isEditDrawerShow = false;                this.isAddDrawerShow = false;            },            /**             * uiActionId:  startUpdateItem             * description: ✅获取表格数据             */            async prepareItemData({item}) {                this.editItem = {...item};            },            async openUpdateDialog() {                this.isEditDrawerShow = true;            },            /**             * uiActionId:  updateItem             * description: ✅获取表格数据             */            async confirmUpdateItemDialog() {                if (await window.confirmDialog({title: "修改", content: "确定修改吗？"}) === false) {                    throw new Error("取消");                }            },            async doUpdateItem() {                const { id, ...data } = this.editItem;                await window.vtoast.loading("修改数据");                await window.jianghuAxios({                    data: {                        appData: {                            pageId: 'studentManagement',                            actionId: 'updateItem',                            actionData: data,                            where: {id}                        }                    }                })                await window.vtoast.success("修改数据成功");            },            /**             * uiActionId:  deleteItem             * description: ✅获取表格数据             */            async confirmDeleteItemDialog() {                if (await window.confirmDialog({title: "删除", content: "确定删除吗？"}) === false) {                    throw new Error("取消");                }            },            async doDeleteItem({item}) {                const { id } = item;                await window.vtoast.loading("删除数据");                await window.jianghuAxios({                    data: {                        appData: {                            pageId: 'studentManagement',                            actionId: 'deleteItem',                            actionData: {},                            where: { id: id }                        }                    }                });                await window.vtoast.success("删除数据成功");            },        }    })</script><style scoped></style>{% endblock %}